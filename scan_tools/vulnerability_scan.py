#!/usr/bin/python3

from socket import *
import os
import sys

def GetBanner(ip, port):
    try:
        setdefaulttimeout(5)
        s = socket()
        s.connect((ip, port))
        banner = s.recv(1024)
        return banner
    except:
        return

def CheckVulns(banner, fileName):
    f = open(fileName, 'r')
    for line in f.readlines():
        if line.strip('\n') in banner:
            print('[+] Server is vulnerable' +banner.strip('\n'))

def main():
    if len(sys.argv) == 2: #to count no of arguments
        fileName = sys.argv[1]
        if not os.path.isfile(fileName):
            print('[-] File Does not exist')
            exit(0)
        if not os.access(fileName, os.R_OK):
            print('[-] Access Denied!')
            exit(0)
    else:
        print('[-] Usage: '+str(sys.argv[0])+ '<vuln filename>')
        exit(0)

    portList = [21, 22, 25, 80, 110, 443, 445]
    for m in range(1, 255): #scan all host on network
        ip = '192.168.1.' + str(m)
        for port in portList:
            banner = GetBanner(ip, port)
            if banner:
                print('[+]' + ip +" / "+ str(port) +": " + banner.decode().strip('/n'))
                CheckVulns(banner, fileName)
main()
